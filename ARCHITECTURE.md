# Архитектура системы REESTRY

## High-Level Overview

Система REESTRY представляет собой комплексное решение для краулинга и обработки открытых данных из украинских государственных порталов.

## Компоненты системы

### 1. Краулер (UkrDeepCrawler)
- **Назначение**: Интеллектуальный веб-краулинг с LLM-анализом
- **Технологии**: Python, Playwright, BeautifulSoup, LMStudio API
- **Функции**:
  - Обход украинских госпорталов (.gov.ua)
  - LLM-анализ контента для определения релевантности
  - Приоритизация URL для обхода
  - Извлечение ссылок на реестры, API и файлы данных

### 2. Обработчик документов
- **Назначение**: Обработка и нормализация загруженных данных
- **Технологии**: Python, Playwright
- **Функции**:
  - Извлечение текста из документов
  - Валидация данных
  - Нормализация и структурирование
  - Сохранение обработанных данных

### 3. PostgreSQL
- **Назначение**: Основное хранилище структурированных данных
- **Использование**:
  - Сырые данные из краулера
  - Обработанные документы
  - Метаданные источников

### 4. Redis
- **Назначение**: Кэширование для оптимизации производительности
- **Использование**:
  - Кэш LLM-запросов
  - Кэш URL
  - Очереди обработки

### 5. Prometheus
- **Назначение**: Сбор метрик системы
- **Метрики**:
  - Производительность краулера
  - Статистика обработки
  - Использование ресурсов БД
  - Состояние сервисов

### 6. Grafana
- **Назначение**: Визуализация метрик и мониторинг
- **Функции**:
  - Дашборды для отслеживания работы системы
  - Алерты на аномалии
  - Аналитика производительности

## Поток данных

1. **Краулинг**:
   - Пользователь запускает краулер
   - Краулер загружает страницы через Playwright
   - Контент анализируется через LMStudio API
   - Результаты кэшируются в Redis
   - Найденные источники сохраняются в PostgreSQL

2. **Обработка**:
   - Обработчик получает данные из PostgreSQL
   - Выполняется извлечение и нормализация
   - Используется кэш Redis для оптимизации
   - Обработанные данные сохраняются обратно в PostgreSQL

3. **Мониторинг**:
   - Все компоненты отправляют метрики в Prometheus
   - Grafana визуализирует метрики
   - Пользователь может отслеживать состояние системы

## Развертывание

Система разворачивается с помощью Terraform, который создает:
- Docker сеть для изоляции контейнеров
- Все необходимые контейнеры с правильными зависимостями
- Volumes для персистентного хранения данных
- Настройки мониторинга и логирования

Все компоненты взаимодействуют через Docker сеть `reestry-network` и могут обращаться друг к другу по именам контейнеров.

## Детальные диаграммы

См. [terraform/ARCHITECTURE.md](terraform/ARCHITECTURE.md) для детальных Mermaid диаграмм архитектуры.

