# Диаграмма обработки RSS-источников

## Текущий процесс (БЕЗ поддержки RSS)

```
┌─────────────────────────────────────────────────────────────┐
│                    КРАУЛЕР (LLMCrawler)                     │
│                                                              │
│  1. Анализ страницы через LLM                               │
│     └─> Ищет: registry, api, data_file, documentation      │
│         ❌ RSS НЕ упоминается                               │
│                                                              │
│  2. Извлечение ссылок                                       │
│     └─> LLM ищет ссылки на реестры, API, файлы              │
│         ❌ RSS-ссылки могут быть найдены случайно,         │
│            но НЕ распознаны как RSS                         │
│                                                              │
│  3. Классификация найденной RSS-ссылки:                    │
│     └─> Может быть классифицирована как:                    │
│         • data_file (если URL содержит .xml/.rss)          │
│         • web (обычная веб-страница)                        │
│         ❌ НЕ как специальный RSS-источник                 │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│              СИСТЕМА ЗАГРУЗКИ ДАННЫХ                        │
│                                                              │
│  Найденная RSS-ссылка попадает в систему:                   │
│                                                              │
│  ┌──────────────────────────────────────────┐              │
│  │  DataDownloadManager.register_source()   │              │
│  │  source_type = "data_file" или "web"    │              │
│  └──────────────────────────────────────────┘              │
│                            │                                 │
│                            ▼                                 │
│  ┌──────────────────────────────────────────┐              │
│  │  Выбор адаптера:                         │              │
│  │  • FileSourceAdapter (если .xml/.rss)   │              │
│  │  • WebSourceAdapter (если веб-страница) │              │
│  │  ❌ RSSFeedAdapter НЕ существует         │              │
│  └──────────────────────────────────────────┘              │
│                            │                                 │
│                            ▼                                 │
│  ┌──────────────────────────────────────────┐              │
│  │  Обработка RSS как обычного файла/страницы│              │
│  │  ❌ RSS-структура НЕ распознается        │              │
│  │  ❌ Элементы (items) НЕ извлекаются      │              │
│  │  ❌ Метаданные (даты, авторы) теряются   │              │
│  │  ❌ Инкрементальное обновление НЕ работает│              │
│  └──────────────────────────────────────────┘              │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│              РЕЗУЛЬТАТ                                      │
│                                                              │
│  ❌ RSS-фид обработан неправильно                           │
│  ❌ Данные могут быть повреждены или неполны                │
│  ❌ Инкрементальное обновление не работает                  │
│  ❌ Метаданные RSS теряются                                 │
└─────────────────────────────────────────────────────────────┘
```

## Улучшенный процесс (С поддержкой RSS)

```
┌─────────────────────────────────────────────────────────────┐
│                    КРАУЛЕР (LLMCrawler)                     │
│                                                              │
│  1. Анализ страницы через LLM                               │
│     └─> Ищет: registry, api, data_file, documentation, RSS│
│         ✅ RSS упоминается в промпте                        │
│                                                              │
│  2. Эвристики для поиска RSS:                               │
│     • Поиск <link rel="alternate" type="application/rss+xml">│
│     • Поиск ссылок с текстом "RSS", "Feed", "Подписка"     │
│     • Поиск URL: /feed, /rss, /atom, .rss, .xml           │
│                                                              │
│  3. Извлечение ссылок                                       │
│     └─> LLM ищет ссылки на реестры, API, файлы, RSS        │
│         ✅ RSS-ссылки распознаются специально               │
│                                                              │
│  4. Классификация найденной RSS-ссылки:                     │
│     └─> Классифицируется как:                              │
│         • source_type = "rss"                               │
│         • priority = 2 (высокий приоритет)                 │
│         • reasoning = "RSS feed для обновлений данных"      │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│              СИСТЕМА ЗАГРУЗКИ ДАННЫХ                        │
│                                                              │
│  Найденная RSS-ссылка попадает в систему:                   │
│                                                              │
│  ┌──────────────────────────────────────────┐              │
│  │  DataDownloadManager.register_source()   │              │
│  │  source_type = "rss"                     │              │
│  └──────────────────────────────────────────┘              │
│                            │                                 │
│                            ▼                                 │
│  ┌──────────────────────────────────────────┐              │
│  │  Выбор адаптера:                         │              │
│  │  ✅ RSSFeedAdapter (специальный адаптер) │              │
│  └──────────────────────────────────────────┘              │
│                            │                                 │
│                            ▼                                 │
│  ┌──────────────────────────────────────────┐              │
│  │  RSSFeedAdapter обрабатывает RSS:       │              │
│  │  ✅ Парсинг RSS-структуры (feedparser)   │              │
│  │  ✅ Извлечение элементов (items)         │              │
│  │  ✅ Сохранение метаданных:               │              │
│  │     - title, description, link           │              │
│  │     - published, updated                 │              │
│  │     - author, categories                 │              │
│  │     - guid (уникальный идентификатор)    │              │
│  │  ✅ Инкрементальная загрузка по датам    │              │
│  └──────────────────────────────────────────┘              │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│              ОБНАРУЖЕНИЕ ИЗМЕНЕНИЙ (ChangeDetector)          │
│                                                              │
│  ✅ Использует published дату для определения новых записей│
│  ✅ Использует guid для идентификации записей               │
│  ✅ Эффективное сравнение (по дате, а не по хешу)           │
│  ✅ Автоматическое обнаружение новых записей                 │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│              ПЕРИОДИЧЕСКИЙ ПЛАНИРОВЩИК                       │
│                                                              │
│  ✅ RSS-источники проверяются чаще (каждые 1-6 часов)      │
│  ✅ Автоматическое обновление при новых записях             │
│  ✅ Эффективное использование ресурсов                      │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│              РЕЗУЛЬТАТ                                       │
│                                                              │
│  ✅ RSS-фид обработан правильно                             │
│  ✅ Все данные и метаданные сохранены                       │
│  ✅ Инкрементальное обновление работает эффективно          │
│  ✅ Автоматическое отслеживание обновлений                  │
│  ✅ Минимальная нагрузка на источники                      │
└─────────────────────────────────────────────────────────────┘
```

## Сравнение подходов

| Аспект | Текущий (без RSS) | Улучшенный (с RSS) |
|--------|-------------------|-------------------|
| **Обнаружение** | ❌ Случайное | ✅ Специальное распознавание |
| **Классификация** | ❌ data_file/web | ✅ rss (специальный тип) |
| **Парсинг** | ❌ Как XML/HTML | ✅ RSS-структура |
| **Метаданные** | ❌ Теряются | ✅ Сохраняются все |
| **Обновления** | ❌ Неэффективно | ✅ По датам публикации |
| **Идентификация** | ❌ По хешу | ✅ По guid/дате |
| **Частота проверок** | ❌ Общая | ✅ Оптимизирована для RSS |

## Примеры RSS-источников

### Типичные паттерны URL:
- `https://data.gov.ua/feed`
- `https://minjust.gov.ua/rss`
- `https://nazk.gov.ua/feed/changes`
- `https://portal.gov.ua/rss/news`
- `https://registry.gov.ua/atom/updates`

### HTML-разметка для обнаружения:
```html
<link rel="alternate" type="application/rss+xml" 
      title="RSS Feed" href="/feed">
      
<a href="/feed">Подписаться на RSS</a>
<a href="/rss">RSS Feed</a>
```

## Выводы

**Текущее состояние:**
- RSS-фиды могут быть найдены случайно
- Но обрабатываются неправильно
- Теряются преимущества RSS (структурированность, метаданные, инкрементальные обновления)

**После улучшений:**
- RSS-фиды будут активно искаться
- Специальная обработка RSS-структуры
- Эффективное инкрементальное обновление
- Полное использование метаданных

**Рекомендация:** Реализовать поддержку RSS как приоритетную задачу для эффективного отслеживания обновлений в государственных порталах.

