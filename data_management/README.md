# Модуль управления данными

Модуль для управления загрузкой, проверки целостности и версионирования данных для ML обучения.

## Компоненты

### 1. DatabaseManager
Менеджер для работы с PostgreSQL. Предоставляет методы для:
- Управления источниками данных
- Работы с целостностью данных
- Версионирования датасетов
- Отслеживания изменений документов

### 2. DataIntegrityChecker
Система проверки целостности данных:
- Вычисление хешей записей
- Сравнение загруженных данных с исходными
- Обнаружение отсутствующих и несовпадающих записей
- Расчет score целостности

### 3. IntegrityMonitor
Мониторинг целостности всех источников:
- Автоматическая проверка всех активных источников
- Генерация отчетов о целостности
- Обновление статусов источников

### 4. DataDownloadManager
Менеджер загрузки данных с возобновлением:
- Регистрация источников разных типов
- Инкрементальная загрузка с пагинацией
- Возобновление прерванных загрузок
- Отслеживание прогресса

### 5. DataSourceAdapter
Адаптеры для разных типов источников:
- **APISourceAdapter** - для REST API
- **FileSourceAdapter** - для файлов (CSV, JSON, XML)
- **WebSourceAdapter** - для веб-страниц

### 6. MLDatasetManager
Менеджер датасетов для ML обучения:
- Создание версий датасетов
- Подготовка данных для обучения
- Инкрементальные обновления
- Экспорт в разных форматах (JSONL, text, HuggingFace)

## Установка

1. Применить миграции БД:
```bash
python3 database/apply_migrations.py
```

2. Установить зависимости:
```bash
pip install psycopg2-binary requests beautifulsoup4
```

## Использование

См. примеры в `example_usage.py`:

```python
from data_management import DatabaseManager, DataDownloadManager

# Инициализация
db = DatabaseManager(...)
download_manager = DataDownloadManager(db)

# Регистрация источника
source_id = download_manager.register_source(
    url='https://api.example.com/data',
    source_type='api'
)

# Загрузка данных
download_manager.resume_download(source_id)
```

## Структура БД

После применения миграций будут созданы таблицы:
- `data_sources` - источники данных
- `data_integrity` - проверка целостности
- `source_snapshots` - снимки исходных данных
- `dataset_versions` - версии датасетов
- `dataset_samples` - образцы датасетов
- `document_changes` - отслеживание изменений

## Интеграция

Модуль интегрируется с существующими компонентами:
- `UkrDeepCrawler` - для обнаружения новых источников
- `download_documents.py` - для загрузки документов
- ML пайплайны - для подготовки данных к обучению

